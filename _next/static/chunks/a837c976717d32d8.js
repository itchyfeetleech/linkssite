(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,84516,e=>{"use strict";e.s(["Sections",()=>t]);let t={BOOT_OVERLAY:"BOOT_OVERLAY",BACKGROUND_CANVAS:"BACKGROUND_CANVAS",FOG_OVERLAY:"FOG_OVERLAY",SHELL_ROOT:"SHELL_ROOT",TERMINAL_WINDOW:"TERMINAL_WINDOW",TERMINAL_TITLEBAR:"TERMINAL_TITLEBAR",TITLEBAR_DOTS:"TITLEBAR_DOTS",TITLEBAR_TITLE:"TITLEBAR_TITLE",SCREEN_VIEWPORT:"SCREEN_VIEWPORT",ASCII_BANNER:"ASCII_BANNER",LINKS_LIST:"LINKS_LIST",LINK_ITEM:"LINK_ITEM",LINK_LABEL:"LINK_LABEL",LINK_ARROW:"LINK_ARROW",LINK_ANCHOR:"LINK_ANCHOR",LENS_WARP_CANVAS:"LENS_WARP_CANVAS",COPPER_SCROLLER:"COPPER_SCROLLER"}},21240,e=>{"use strict";e.s(["default",()=>ee,"setCRTAlive",()=>Z,"setPhosphor",()=>J],21240);var t=e.i(43476),r=e.i(71645),n=e.i(84516),a=e.i(47167);let i=(()=>{let e=0;return()=>(e+=1,"u".concat("0000".concat((1679616*Math.random()|0).toString(36)).slice(-4)).concat(e))})();function o(e){let t=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r]);return t}function l(e,t){let r=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return r?parseFloat(r.replace("px","")):0}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{width:t.width||function(e){let t=l(e,"border-left-width"),r=l(e,"border-right-width");return e.clientWidth+t+r}(e),height:t.height||function(e){let t=l(e,"border-top-width"),r=l(e,"border-bottom-width");return e.clientHeight+t+r}(e)}}function u(e){return new Promise((t,r)=>{let n=new Image;n.decode=()=>t(n),n.onload=()=>t(n),n.onerror=r,n.crossOrigin="anonymous",n.decoding="async",n.src=e})}async function s(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(e=>"data:image/svg+xml;charset=utf-8,".concat(e))}async function f(e,t,r){let n="http://www.w3.org/2000/svg",a=document.createElementNS(n,"svg"),i=document.createElementNS(n,"foreignObject");return a.setAttribute("width","".concat(t)),a.setAttribute("height","".concat(r)),a.setAttribute("viewBox","0 0 ".concat(t," ").concat(r)),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),a.appendChild(i),i.appendChild(e),s(a)}let m=(e,t)=>{if(e instanceof t)return!0;let r=Object.getPrototypeOf(e);return null!==r&&(r.constructor.name===t.name||m(r,t))};function d(e,t,r){let n=window.getComputedStyle(e,r),a=n.getPropertyValue("content");if(""===a||"none"===a)return;let l=i();try{t.className="".concat(t.className," ").concat(l)}catch(e){return}let c=document.createElement("style");c.appendChild(function(e,t,r){let n=".".concat(e,":").concat(t),a=r.cssText?function(e){let t=e.getPropertyValue("content");return"".concat(e.cssText," content: '").concat(t.replace(/'|"/g,""),"';")}(r):o(r).map(e=>{let t=r.getPropertyValue(e),n=r.getPropertyPriority(e);return"".concat(e,": ").concat(t).concat(n?" !important":"",";")}).join(" ");return document.createTextNode("".concat(n,"{").concat(a,"}"))}(l,r,n)),t.appendChild(c)}let h="application/font-woff",v="image/jpeg",p={woff:h,woff2:h,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:v,jpeg:v,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function E(e){return p[(function(e){let t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""})(e).toLowerCase()]||""}function _(e){return -1!==e.search(/^(data:)/)}function T(e,t){return"data:".concat(t,";base64,").concat(e)}async function g(e,t,r){let n=await fetch(e,t);if(404===n.status)throw Error('Resource "'.concat(n.url,'" not found'));let a=await n.blob();return new Promise((e,t)=>{let i=new FileReader;i.onerror=t,i.onloadend=()=>{try{e(r({res:n,result:i.result}))}catch(e){t(e)}},i.readAsDataURL(a)})}let R={};async function x(e,t,r){var n,a,i;let o,l,c=(n=e,a=t,i=r.includeQueryParams,l=n.replace(/\?.*/,""),i&&(l=n),/ttf|otf|eot|woff2?/i.test(l)&&(l=l.replace(/.*\//,"")),a?"[".concat(a,"]").concat(l):l);if(null!=R[c])return R[c];r.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());try{let n=await g(e,r.fetchRequestInit,e=>{let{res:r,result:n}=e;return t||(t=r.headers.get("Content-Type")||""),n.split(/,/)[1]});o=T(n,t)}catch(n){o=r.imagePlaceholder||"";let t="Failed to fetch resource: ".concat(e);n&&(t="string"==typeof n?n:n.message),t&&console.warn(t)}return R[c]=o,o}async function w(e){let t=e.toDataURL();return"data:,"===t?e.cloneNode(!1):u(t)}async function b(e,t){if(e.currentSrc){let t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.clientWidth,t.height=e.clientHeight,null==r||r.drawImage(e,0,0,t.width,t.height),u(t.toDataURL())}let r=e.poster,n=E(r);return u(await x(r,n,t))}async function y(e){var t;try{if(null==(t=null==e?void 0:e.contentDocument)?void 0:t.body)return await P(e.contentDocument.body,{},!0)}catch(e){}return e.cloneNode(!1)}async function L(e,t){return m(e,HTMLCanvasElement)?w(e):m(e,HTMLVideoElement)?b(e,t):m(e,HTMLIFrameElement)?y(e):e.cloneNode(!1)}async function A(e,t,r){var n,a;let i=[];return 0===(i=null!=e.tagName&&"SLOT"===e.tagName.toUpperCase()&&e.assignedNodes?o(e.assignedNodes()):m(e,HTMLIFrameElement)&&(null==(n=e.contentDocument)?void 0:n.body)?o(e.contentDocument.body.childNodes):o((null!=(a=e.shadowRoot)?a:e).childNodes)).length||m(e,HTMLVideoElement)||await i.reduce((e,n)=>e.then(()=>P(n,r)).then(e=>{e&&t.appendChild(e)}),Promise.resolve()),t}async function U(e,t){let r=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===r.length)return e;let n={};for(let a=0;a<r.length;a++){let i=r[a].getAttribute("xlink:href");if(i){let r=e.querySelector(i),a=document.querySelector(i);r||!a||n[i]||(n[i]=await P(a,t,!0))}}let a=Object.values(n);if(a.length){let t="http://www.w3.org/1999/xhtml",r=document.createElementNS(t,"svg");r.setAttribute("xmlns",t),r.style.position="absolute",r.style.width="0",r.style.height="0",r.style.overflow="hidden",r.style.display="none";let n=document.createElementNS(t,"defs");r.appendChild(n);for(let e=0;e<a.length;e++)n.appendChild(a[e]);e.appendChild(r)}return e}async function P(e,t,r){return r||!t.filter||t.filter(e)?Promise.resolve(e).then(e=>L(e,t)).then(r=>A(e,r,t)).then(t=>(function(e,t){if(m(t,Element)&&(!function(e,t){let r=t.style;if(!r)return;let n=window.getComputedStyle(e);n.cssText?(r.cssText=n.cssText,r.transformOrigin=n.transformOrigin):o(n).forEach(a=>{let i=n.getPropertyValue(a);if("font-size"===a&&i.endsWith("px")){let e=Math.floor(parseFloat(i.substring(0,i.length-2)))-.1;i="".concat(e,"px")}m(e,HTMLIFrameElement)&&"display"===a&&"inline"===i&&(i="block"),"d"===a&&t.getAttribute("d")&&(i="path(".concat(t.getAttribute("d"),")")),r.setProperty(a,i,n.getPropertyPriority(a))})}(e,t),d(e,t,":before"),d(e,t,":after"),m(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),m(e,HTMLInputElement)&&t.setAttribute("value",e.value),m(e,HTMLSelectElement))){let r=Array.from(t.children).find(t=>e.value===t.getAttribute("value"));r&&r.setAttribute("selected","")}return t})(e,t)).then(e=>U(e,t)):null}let S=/url\((['"]?)([^'"]+?)\1\)/g,M=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,D=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function I(e,t,r,n,a){try{let i,o=r?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;let r=document.implementation.createHTMLDocument(),n=r.createElement("base"),a=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(a),t&&(n.href=t),a.href=e,a.href}(t,r):t,l=E(t);if(a){let e=await a(o);i=T(e,l)}else i=await x(o,l,n);return e.replace(function(e){let t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return RegExp("(url\\(['\"]?)(".concat(t,")(['\"]?\\))"),"g")}(t),"$1".concat(i,"$3"))}catch(e){}return e}function C(e){return -1!==e.search(S)}async function N(e,t,r){if(!C(e))return e;let n=function(e,t){let{preferredFontFormat:r}=t;return r?e.replace(D,e=>{for(;;){let[t,,n]=M.exec(e)||[];if(!n)return"";if(n===r)return"src: ".concat(t,";")}}):e}(e,r);return(function(e){let t=[];return e.replace(S,(e,r,n)=>(t.push(n),e)),t.filter(e=>!_(e))})(n).reduce((e,n)=>e.then(e=>I(e,n,t,r)),Promise.resolve(n))}async function X(e,t,r){var n;let a=null==(n=t.style)?void 0:n.getPropertyValue(e);if(a){let n=await N(a,null,r);return t.style.setProperty(e,n,t.style.getPropertyPriority(e)),!0}return!1}async function O(e,t){await X("background",e,t)||await X("background-image",e,t),await X("mask",e,t)||await X("mask-image",e,t)}async function F(e,t){let r=m(e,HTMLImageElement);if(!(r&&!_(e.src))&&!(m(e,SVGImageElement)&&!_(e.href.baseVal)))return;let n=r?e.src:e.href.baseVal,a=await x(n,E(n),t);await new Promise((t,n)=>{e.onload=t,e.onerror=n,e.decode&&(e.decode=t),"lazy"===e.loading&&(e.loading="eager"),r?(e.srcset="",e.src=a):e.href.baseVal=a})}async function B(e,t){let r=o(e.childNodes).map(e=>k(e,t));await Promise.all(r).then(()=>e)}async function k(e,t){m(e,Element)&&(await O(e,t),await F(e,t),await B(e,t))}let G={};async function H(e){let t=G[e];if(null!=t)return t;let r=await fetch(e);return t={url:e,cssText:await r.text()},G[e]=t,t}async function z(e,t){let r=e.cssText,n=/url\(["']?([^"')]+)["']?\)/g;return Promise.all((r.match(/url\([^)]+\)/g)||[]).map(async a=>{let i=a.replace(n,"$1");return i.startsWith("https://")||(i=new URL(i,e.url).href),g(i,t.fetchRequestInit,e=>{let{result:t}=e;return r=r.replace(a,"url(".concat(t,")")),[a,t]})})).then(()=>r)}function W(e){if(null==e)return[];let t=[],r=e.replace(/(\/\*[\s\S]*?\*\/)/gi,""),n=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){let e=n.exec(r);if(null===e)break;t.push(e[0])}r=r.replace(n,"");let a=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=a.exec(r);if(null===e){if(null===(e=i.exec(r)))break;a.lastIndex=i.lastIndex}else i.lastIndex=a.lastIndex;t.push(e[0])}return t}async function V(e,t){let r=[],n=[];return e.forEach(r=>{if("cssRules"in r)try{o(r.cssRules||[]).forEach((e,a)=>{if(e.type===CSSRule.IMPORT_RULE){let i=a+1,o=e.href,l=H(o).then(e=>z(e,t)).then(e=>W(e).forEach(e=>{try{r.insertRule(e,e.startsWith("@import")?i+=1:r.cssRules.length)}catch(t){console.error("Error inserting rule from remote css",{rule:e,error:t})}})).catch(e=>{console.error("Error loading remote css",e.toString())});n.push(l)}})}catch(i){let a=e.find(e=>null==e.href)||document.styleSheets[0];null!=r.href&&n.push(H(r.href).then(e=>z(e,t)).then(e=>W(e).forEach(e=>{a.insertRule(e,r.cssRules.length)})).catch(e=>{console.error("Error loading remote stylesheet",e)})),console.error("Error inlining remote css file",i)}}),Promise.all(n).then(()=>(e.forEach(e=>{if("cssRules"in e)try{o(e.cssRules||[]).forEach(e=>{r.push(e)})}catch(t){console.error("Error while reading CSS rules from ".concat(e.href),t)}}),r))}async function j(e,t){if(null==e.ownerDocument)throw Error("Provided element is not within a Document");let r=o(e.ownerDocument.styleSheets);return(await V(r,t)).filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>C(e.style.getPropertyValue("src")))}async function K(e,t){let r=await j(e,t);return(await Promise.all(r.map(e=>{let r=e.parentStyleSheet?e.parentStyleSheet.href:null;return N(e.cssText,r,t)}))).join("\n")}async function Y(e,t){let r=null!=t.fontEmbedCSS?t.fontEmbedCSS:t.skipFonts?null:await K(e,t);if(r){let t=document.createElement("style"),n=document.createTextNode(r);t.appendChild(n),e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}}async function q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{width:r,height:n}=c(e,t),a=await P(e,t,!0);return await Y(a,t),await k(a,t),!function(e,t){let{style:r}=e;t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width="".concat(t.width,"px")),t.height&&(r.height="".concat(t.height,"px"));let n=t.style;null!=n&&Object.keys(n).forEach(e=>{r[e]=n[e]})}(a,t),await f(a,r,n)}async function Q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{width:r,height:n}=c(e,t),i=await q(e,t),o=await u(i),l=document.createElement("canvas"),s=l.getContext("2d"),f=t.pixelRatio||function(){let e,t;try{t=a.default}catch(e){}let r=t&&t.env?t.env.devicePixelRatio:null;return r&&Number.isNaN(e=parseInt(r,10))&&(e=1),e||window.devicePixelRatio||1}(),m=t.canvasWidth||r,d=t.canvasHeight||n;return l.width=m*f,l.height=d*f,!t.skipAutoScale&&(l.width>16384||l.height>16384)&&(l.width>16384&&l.height>16384?l.width>l.height?(l.height*=16384/l.width,l.width=16384):(l.width*=16384/l.height,l.height=16384):l.width>16384?(l.height*=16384/l.width,l.width=16384):(l.width*=16384/l.height,l.height=16384)),l.style.width="".concat(m),l.style.height="".concat(d),t.backgroundColor&&(s.fillStyle=t.backgroundColor,s.fillRect(0,0,l.width,l.height)),s.drawImage(o,0,0,l.width,l.height),l}async function $(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await Q(e,t)).toDataURL()}function Z(e,t){let r=Math.max(0,Math.min(1,e));window.dispatchEvent(new CustomEvent("crt-alive",{detail:{alive:r,mainsHz:t}}))}function J(e){window.dispatchEvent(new CustomEvent("crt-phosphor",{detail:e}))}function ee(e){let{k1:a=.012,k2:i=.002,center:o={x:.5,y:.5}}=e,l=(0,r.useRef)(null),c=(0,r.useRef)(null),u=(0,r.useRef)(null),s=(0,r.useRef)(null),f=(0,r.useRef)(!1),m=(0,r.useRef)(1),d=(0,r.useRef)(null),h=(0,r.useRef)(null),v=(0,r.useRef)(0),p=(0,r.useRef)(!1),E=(0,r.useRef)(.6),_=(0,r.useRef)(50),T=(0,r.useRef)(!1),g=(0,r.useRef)(60),R=(0,r.useRef)(performance.now()),x=(0,r.useRef)(null),w=(0,r.useRef)(null),b=(0,r.useRef)(0),y=(0,r.useRef)({r:.09,g:.11,b:.14}),L=(0,r.useRef)(1),A=(0,r.useRef)(!0),U=(0,r.useRef)(1.2),P=(0,r.useRef)(.12),S=(0,r.useRef)(!1);return(0,r.useEffect)(()=>{var e,t,r,n;let M=l.current;if(!M)return;f.current=null!=(n=null==(t=(r=window).matchMedia)||null==(e=t.call(r,"(prefers-reduced-motion: reduce)"))?void 0:e.matches)&&n;let D=e=>{var t,r;"number"==typeof(null==(t=e.detail)?void 0:t.alive)&&(E.current=Math.max(0,Math.min(1,e.detail.alive))),"number"==typeof(null==(r=e.detail)?void 0:r.mainsHz)&&(_.current=e.detail.mainsHz)};window.addEventListener("crt-alive",D);let I=M.parentElement;if(!I)return;let C=null;try{let e=new URL(window.location.href).searchParams.get("crt");if(e){let t=e.toUpperCase();("HQ"===t||"LQ"===t)&&(C=t)}if(!C){let e=localStorage.getItem("crt-mode");if(e){let t=e.toUpperCase();("HQ"===t||"LQ"===t)&&(C=t)}}}catch(e){}if("LQ"!==C&&(()=>{let e=M.getContext("webgl2",{premultipliedAlpha:!0});if(!e)return!1;let t=e=>{var t,r,n,a;"number"==typeof(null==(t=e.detail)?void 0:t.rMs)&&(y.current.r=Math.max(.01,e.detail.rMs)),"number"==typeof(null==(r=e.detail)?void 0:r.gMs)&&(y.current.g=Math.max(.01,e.detail.gMs)),"number"==typeof(null==(n=e.detail)?void 0:n.bMs)&&(y.current.b=Math.max(.01,e.detail.bMs)),"number"==typeof(null==(a=e.detail)?void 0:a.halo)&&(L.current=Math.max(0,e.detail.halo))};window.addEventListener("crt-phosphor",t);let r=e=>{var t,r,n,a;"boolean"==typeof(null==(t=e.detail)?void 0:t.on)&&(A.current=e.detail.on),"number"==typeof(null==(r=e.detail)?void 0:r.beamPx)&&(U.current=Math.max(.5,Math.min(3,e.detail.beamPx))),"number"==typeof(null==(n=e.detail)?void 0:n.modDepth)&&(P.current=Math.max(0,Math.min(.3,e.detail.modDepth))),"boolean"==typeof(null==(a=e.detail)?void 0:a.interlace)&&(S.current=e.detail.interlace)};window.addEventListener("crt-beam",r);let n=!!e.getExtension("EXT_color_buffer_float"),l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW);let c=(t,r)=>{let n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||console.error(e.getShaderInfoLog(n)),n},u=c(e.VERTEX_SHADER,"#version 300 es\nprecision highp float; layout(location=0) in vec2 position; out vec2 vUv; void main(){ vUv=(position+1.0)*0.5; gl_Position=vec4(position,0.0,1.0);} "),s=c(e.FRAGMENT_SHADER,"#version 300 es\nprecision highp float; layout(location=0) out vec4 oPhi; layout(location=1) out vec4 oBright; in vec2 vUv;\nuniform sampler2D u_tex; uniform sampler2D u_prevPhi; uniform sampler2D u_beamMask;\nuniform vec2 u_res; uniform vec2 u_center; uniform float u_k1; uniform float u_k2; uniform float u_time; uniform float u_dt; uniform float u_alive; uniform float u_mainsHz; uniform vec3 u_decayF;\nuniform float u_beamOn; uniform float u_beamPx; uniform float u_modDepth; uniform float u_interlace;\nfloat hash1(float x){ return fract(sin(x*127.1)*43758.5453123); }\nvec2 barrel(vec2 uv, float k1, float k2){ vec2 p=(uv-u_center)*2.0; float aspect=u_res.x/u_res.y; p.x*=aspect; float r2=dot(p,p); float f=1.0 + k1*r2 + k2*r2*r2; p*=f; p.x/=aspect; return u_center + p*0.5; }\nvoid main(){ float phase=6.2831853*u_mainsHz*u_time; float line=float(int(gl_FragCoord.y)); float jitter=(0.25/u_res.x)*sin(phase+line*0.015)*u_alive; float drift=sin(phase*0.07+line*0.011)*(0.15/u_res.x)*u_alive; float t2=floor(u_time*2.0); float n=hash1(line+t2*31.7); drift+=(n-0.5)*(0.05/u_res.x)*u_alive; float dX=clamp(jitter+drift,-0.4/u_res.x,0.4/u_res.x); vec2 uvR=barrel(vUv+vec2( 0.0002,0.0),u_k1,u_k2); vec2 uvG=barrel(vUv,u_k1,u_k2); vec2 uvB=barrel(vUv+vec2(-0.0002,0.0),u_k1,u_k2); uvR.x+=dX; uvG.x+=dX; uvB.x+=dX; uvR=clamp(uvR,vec2(0.0),vec2(1.0)); uvG=clamp(uvG,vec2(0.0),vec2(1.0)); uvB=clamp(uvB,vec2(0.0),vec2(1.0)); vec3 src; src.r=texture(u_tex,uvR).r; src.g=texture(u_tex,uvG).g; src.b=texture(u_tex,uvB).b; vec3 baseLin=pow(max(src,vec3(0.0)), vec3(2.2));\n  // Dynamic beam and scanline mask in linear space\n  float px = vUv.x * u_res.x; float py = vUv.y * u_res.y;\n  float sweep = fract(u_time * u_mainsHz); float py0 = sweep * u_res.y + (u_interlace>0.5 ? 0.5 : 0.0);\n  float s = fract(px / 3.0); float t = clamp(0.5 + (py - py0) / max(1.0, 6.0*u_beamPx), 0.0, 1.0);\n  vec3 beamRGB = texture(u_beamMask, vec2(s, t)).rgb;\n  baseLin *= (1.0 + u_beamOn * u_modDepth * beamRGB);\n  // vertical retrace highlight (~3% additive, ~4px wide) near left edge\n  float dx = abs(px - 2.0); float retrace = 0.03 * exp(-0.5 * (dx*dx) / (2.0*2.0));\n  baseLin += retrace * u_beamOn;\n  vec3 prev=texture(u_prevPhi, vUv).rgb; vec3 newPhi=max(baseLin, mix(vec3(0.0), prev*u_decayF, u_alive)); vec3 bright=max(newPhi-vec3(0.6), vec3(0.0)); oPhi=vec4(newPhi,1.0); oBright=vec4(bright,1.0);} "),D=c(e.FRAGMENT_SHADER,"#version 300 es\nprecision highp float; out vec4 frag; in vec2 vUv; uniform sampler2D u_phi; uniform sampler2D u_bright; uniform sampler2D u_noise; uniform vec2 u_res; uniform float u_alive; uniform float u_halo;\nvec3 bloom(vec2 uv){ vec2 px=1.0/u_res; vec3 s=vec3(0.0); for(int i=0;i<8;i++){ float a=6.2831853*float(i)/8.0; vec2 d=vec2(cos(a),sin(a)); s+=textureLod(u_bright, uv+d*px*1.5,1.0).rgb*0.20; s+=textureLod(u_bright, uv+d*px*2.5,2.0).rgb*0.12; s+=textureLod(u_bright, uv+d*px*4.0,3.0).rgb*0.08; } return s; }\nvoid main(){ vec3 phi=texture(u_phi,vUv).rgb; vec3 halo=bloom(vUv)*(0.7*u_alive); vec3 maxHalo=0.06*max(phi,vec3(0.0))*u_alive; halo=clamp(halo*u_halo, vec3(0.0), maxHalo); vec3 colLin=phi+halo; float tri=fract((vUv.x*u_res.x)/3.0); vec3 mask=normalize(vec3(smoothstep(0.0,0.33,tri), smoothstep(0.33,0.66,tri), smoothstep(0.66,1.0,tri))+1e-3); colLin*=mix(vec3(1.0), mask*3.0, 0.03*u_alive); vec3 srgb=pow(max(colLin,vec3(0.0)), vec3(1.0/2.2)); float n=texture(u_noise, vUv*8.0).r; srgb += (n-0.5)*(1.5/255.0); frag=vec4(clamp(srgb,0.0,1.0),1.0);} "),C=e.createProgram();if(e.attachShader(C,u),e.attachShader(C,s),e.linkProgram(C),!e.getProgramParameter(C,e.LINK_STATUS))return console.error(e.getProgramInfoLog(C)),window.removeEventListener("crt-phosphor",t),!1;let N=e.createProgram();if(e.attachShader(N,u),e.attachShader(N,D),e.linkProgram(N),!e.getProgramParameter(N,e.LINK_STATUS))return console.error(e.getProgramInfoLog(N)),window.removeEventListener("crt-phosphor",t),!1;e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);let X=t=>{let r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),r},O=X(!1),F=X(!1),B=X(!0),k=e.createTexture();e.bindTexture(e.TEXTURE_2D,k),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);let G=e.createTexture();e.bindTexture(e.TEXTURE_2D,G);let H=new Uint8Array(4096);for(let e=0;e<4096;e++)H[e]=256*Math.random()|0;e.texImage2D(e.TEXTURE_2D,0,e.R8,64,64,0,e.RED,e.UNSIGNED_BYTE,H),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT);let z=new Uint8Array(786432);for(let e=0;e<512;e++){let t=e-256,r=Math.exp(-(t*t*.5)/2621.4400000000005);for(let t=0;t<512;t++){let n=Math.floor(3*t/512)%3,a=(512*e+t)*3;z[a+0]=0===n?Math.min(255,Math.floor(255*r)):0,z[a+1]=1===n?Math.min(255,Math.floor(255*r)):0,z[a+2]=2===n?Math.min(255,Math.floor(255*r)):0}}let W=e.createTexture();e.bindTexture(e.TEXTURE_2D,W),e.texImage2D(e.TEXTURE_2D,0,e.RGB8,512,512,0,e.RGB,e.UNSIGNED_BYTE,z),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);let V=e.createFramebuffer(),j=1,K=1,Y=O,q=F,Q=(t,r,a)=>{e.bindTexture(e.TEXTURE_2D,t);let i=n?e.RGBA16F:e.RGBA8,o=n?e.HALF_FLOAT:e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,0,i,r,a,0,e.RGBA,o,null)},Z=()=>{let t=I.getBoundingClientRect(),r=Math.min(Math.max(window.devicePixelRatio||1,2),2.5);m.current=r;let n=Math.max(1,Math.floor(t.width)),a=Math.max(1,Math.floor(t.height));M.width=Math.floor(n*r),M.height=Math.floor(a*r),M.style.width="".concat(n,"px"),M.style.height="".concat(a,"px"),e.viewport(0,0,M.width,M.height),j=M.width,K=M.height,Q(O,j,K),Q(F,j,K),Q(B,j,K)};Z();let J={tex:e.getUniformLocation(C,"u_tex"),prev:e.getUniformLocation(C,"u_prevPhi"),beamMask:e.getUniformLocation(C,"u_beamMask"),res:e.getUniformLocation(C,"u_res"),ctr:e.getUniformLocation(C,"u_center"),k1:e.getUniformLocation(C,"u_k1"),k2:e.getUniformLocation(C,"u_k2"),time:e.getUniformLocation(C,"u_time"),dt:e.getUniformLocation(C,"u_dt"),alive:e.getUniformLocation(C,"u_alive"),mains:e.getUniformLocation(C,"u_mainsHz"),decayF:e.getUniformLocation(C,"u_decayF"),beamOn:e.getUniformLocation(C,"u_beamOn"),beamPx:e.getUniformLocation(C,"u_beamPx"),modDepth:e.getUniformLocation(C,"u_modDepth"),interlace:e.getUniformLocation(C,"u_interlace")},ee={phi:e.getUniformLocation(N,"u_phi"),bright:e.getUniformLocation(N,"u_bright"),noise:e.getUniformLocation(N,"u_noise"),res:e.getUniformLocation(N,"u_res"),alive:e.getUniformLocation(N,"u_alive"),halo:e.getUniformLocation(N,"u_halo")},et=()=>{let t=performance.now(),r=Math.max(1e-4,(t-R.current)*.001);R.current=t;let l=1/r;g.current=.9*g.current+.1*l,g.current<30?(null==x.current&&(x.current=t),!T.current&&x.current&&t-x.current>3e3&&(T.current=!0)):(x.current=null,T.current?(null==w.current&&(w.current=t),t-w.current>1500&&(T.current=!1)):w.current=null);let c=Math.min(f.current?0:E.current,T.current?.3:1);e.useProgram(C),e.bindFramebuffer(e.FRAMEBUFFER,V),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,q,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT1,e.TEXTURE_2D,B,0),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1]),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,k),J.tex&&e.uniform1i(J.tex,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,Y),J.prev&&e.uniform1i(J.prev,1),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,W),J.beamMask&&e.uniform1i(J.beamMask,2),J.res&&e.uniform2f(J.res,j,K),J.ctr&&e.uniform2f(J.ctr,o.x,o.y),J.k1&&e.uniform1f(J.k1,a),J.k2&&e.uniform1f(J.k2,i),J.time&&e.uniform1f(J.time,.001*t),J.dt&&e.uniform1f(J.dt,r),J.alive&&e.uniform1f(J.alive,c),J.mains&&e.uniform1f(J.mains,_.current||60);let u=[Math.exp(-r/y.current.r),Math.exp(-r/y.current.g),Math.exp(-r/y.current.b)];if(J.decayF&&e.uniform3f(J.decayF,u[0],u[1],u[2]),J.beamOn&&e.uniform1f(J.beamOn,+!!A.current),J.beamPx&&e.uniform1f(J.beamPx,U.current),J.modDepth&&e.uniform1f(J.modDepth,P.current),J.interlace&&e.uniform1f(J.interlace,+!!S.current),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,B),e.generateMipmap(e.TEXTURE_2D),e.bindFramebuffer(e.FRAMEBUFFER,null),e.useProgram(N),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,q),ee.phi&&e.uniform1i(ee.phi,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,B),ee.bright&&e.uniform1i(ee.bright,1),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,G),ee.noise&&e.uniform1i(ee.noise,2),ee.res&&e.uniform2f(ee.res,j,K),ee.alive&&e.uniform1f(ee.alive,c),ee.halo&&e.uniform1f(ee.halo,L.current),e.drawArrays(e.TRIANGLES,0,6),t-b.current>500){b.current=t;try{window.dispatchEvent(new CustomEvent("crt-state",{detail:{alive:E.current,effectiveAlive:c,mainsHz:_.current,fps:g.current,gated:T.current,reduced:f.current,mode:"HQ",buffers:(n?"rgba16f":"rgba8")+"+mrt+mip",decayMs:{...y.current},halo:L.current,beam:{on:A.current,beamPx:U.current,modDepth:P.current,interlace:S.current}}}))}catch(e){}}let s=Y;Y=q,q=s,f.current||(d.current=requestAnimationFrame(et))},er=!1,en=async()=>{if(!er){er=!0;try{let t=await $(I,{pixelRatio:m.current,cacheBust:!0,filter:e=>!(e instanceof Element)||e!==M&&!e.classList.contains("lens-warp")}),r=new Image;r.onload=()=>{e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,k),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),et(),p.current||(p.current=!0,requestAnimationFrame(()=>window.dispatchEvent(new Event("webgl-ready"))))},r.src=t}catch(e){console.warn("Lens capture failed",e)}finally{v.current=performance.now(),er=!1}}},ea=()=>{if(h.current)return;let e=Math.max(200,200-(performance.now()-v.current));h.current=window.setTimeout(()=>{h.current=null,en()},e)},ei=new ResizeObserver(()=>{m.current=Math.min(Math.max(window.devicePixelRatio||1,2),2.5),Z(),ea()});return ei.observe(I),window.addEventListener("resize",ea),window.addEventListener("ascii-ready",en),M.addEventListener("webglcontextlost",n=>{n.preventDefault(),window.removeEventListener("crt-phosphor",t),window.removeEventListener("crt-beam",r),ei.disconnect(),window.removeEventListener("resize",ea),window.removeEventListener("ascii-ready",en),d.current&&cancelAnimationFrame(d.current),e.deleteFramebuffer(V),e.deleteTexture(O),e.deleteTexture(F),e.deleteTexture(B),e.deleteTexture(G),e.deleteTexture(k),e.deleteProgram(C),e.deleteProgram(N),e.deleteShader(u),e.deleteShader(s),e.deleteShader(D),e.deleteBuffer(l)},!1),et(),!0})())return()=>{};let N=M.getContext("webgl",{premultipliedAlpha:!0});if(!N)return;s.current=N;let X=(e,t)=>{let r=N.createShader(e);return N.shaderSource(r,t),N.compileShader(r),N.getShaderParameter(r,N.COMPILE_STATUS)||console.error("Lens shader compile error:",N.getShaderInfoLog(r)),r},O=X(N.VERTEX_SHADER,"\n      attribute vec2 position;\n      varying vec2 vUv;\n      void main(){\n        vUv = (position + 1.0) * 0.5;\n        gl_Position = vec4(position, 0.0, 1.0);\n      }\n    "),F=X(N.FRAGMENT_SHADER,"\n      precision mediump float;\n      varying vec2 vUv;\n      uniform sampler2D u_tex;\n      uniform vec2 u_res;\n      uniform vec2 u_center;\n      uniform float u_k1;\n      uniform float u_k2;\n      uniform float u_time;  // seconds\n      uniform float u_alive; // 0..1 micro-effects strength\n      uniform float u_mainsHz; // 50 or 60\n      uniform float u_motion; // 0 = reduced, 1 = animate\n      uniform float u_intensity; // global strength\n      \n      // Small hash for phase noise\n      float hash1(float x){ return fract(sin(x*127.1) * 43758.5453123); }\n      // Distort coordinates using Brown-Conrady barrel model\n      vec2 barrel(vec2 uv, float k1, float k2){\n        vec2 p = (uv - u_center) * 2.0; // roughly [-1,1]\n        // normalize to aspect so distortion is radially symmetric\n        float aspect = u_res.x / u_res.y;\n        p.x *= aspect;\n        float r2 = dot(p, p);\n        float f = 1.0 + k1 * r2 + k2 * r2 * r2;\n        p *= f;\n        p.x /= aspect;\n        return u_center + p * 0.5;\n      }\n      void main(){\n        // Slight chromatic aberration: offset R/B samples inwards/outwards\n        float dr = 0.0002 * u_intensity; // very subtle for readability\n        vec2 baseUv = vUv; // texture already flipped via UNPACK_FLIP_Y_WEBGL\n        vec2 uvR = barrel(baseUv + vec2( dr, 0.0), u_k1, u_k2);\n        vec2 uvG = barrel(baseUv,                  u_k1, u_k2);\n        vec2 uvB = barrel(baseUv + vec2(-dr, 0.0), u_k1, u_k2);\n        \n        // Time-based micro-effects (horizontal)\n        float phase = 6.2831853 * u_mainsHz * u_time;\n        float line = gl_FragCoord.y;\n        // Effect 1: mains-rate beam jitter\n        float jitter = (0.25 / u_res.x) * sin(phase + line * 0.015) * u_alive;\n        // Effect 2: scanline phase noise (slow drift + tiny hashed jitter)\n        float drift = sin(phase * 0.07 + line * 0.011) * (0.15 / u_res.x) * u_alive;\n        float t2 = floor(u_time * 2.0);\n        float n = hash1(line + t2 * 31.7);\n        drift += (n - 0.5) * (0.05 / u_res.x) * u_alive; // ≤ 0.05px extra\n        float dX = clamp(jitter + drift, -0.4 / u_res.x, 0.4 / u_res.x);\n        uvR.x += dX; uvG.x += dX; uvB.x += dX;\n        // Clamp to avoid wrapping\n        uvR = clamp(uvR, vec2(0.0), vec2(1.0));\n        uvG = clamp(uvG, vec2(0.0), vec2(1.0));\n        uvB = clamp(uvB, vec2(0.0), vec2(1.0));\n        vec3 col;\n        col.r = texture2D(u_tex, uvR).r;\n        col.g = texture2D(u_tex, uvG).g;\n        col.b = texture2D(u_tex, uvB).b;\n\n        // Effect 3: triad shimmer (mix at low weight)\n        if (u_alive > 0.0005) {\n          float triad = fract((uvG.x * u_res.x) / 3.0);\n          float sPx = 0.002 * sin(phase * 0.5 + triad * 6.2831853) * u_alive; // very subtle\n          float px = 1.0 / u_res.x;\n          float rShift = (sPx + 0.15) * px;\n          float bShift = -(sPx + 0.15) * px;\n          vec3 triadCol;\n          triadCol.r = texture2D(u_tex, clamp(uvG + vec2(rShift, 0.0), vec2(0.0), vec2(1.0))).r;\n          triadCol.g = col.g;\n          triadCol.b = texture2D(u_tex, clamp(uvG + vec2(bShift, 0.0), vec2(0.0), vec2(1.0))).b;\n          float w = 0.20 * u_alive; // keep luminance modulation small\n          col = mix(col, triadCol, w);\n        }\n\n        // CRT effects in shader (subtle by default)\n        float I = u_intensity; // shorthand\n\n        // Scanlines (horizontal darkening)\n        float pxY = uvG.y * u_res.y;\n        float scan = 0.5 + 0.5 * cos(6.28318 * (pxY / 3.0)); // 3px period\n        float scanAmp = 0.06 * I;\n        col *= mix(1.0 - scanAmp, 1.0, scan);\n\n        // Aperture grille (vertical faint dark stripes)\n        float pxX = uvG.x * u_res.x;\n        float grille = 0.5 + 0.5 * cos(6.28318 * (pxX / 3.0));\n        float grilleAmp = 0.04 * I;\n        col *= mix(1.0 - grilleAmp, 1.0, grille);\n\n        // Rolling band (very subtle, moves only if motion enabled)\n        float bandAmp = 0.04 * I;\n        float pos = fract(uvG.y + (u_motion * u_time * 0.03));\n        float band = smoothstep(0.45, 0.5, pos) * smoothstep(0.55, 0.5, pos);\n        col *= 1.0 + bandAmp * band;\n\n        // Vignette / edge falloff\n        vec2 c = (uvG - u_center) * vec2(u_res.x / u_res.y, 1.0);\n        float r = length(c);\n        float vig = smoothstep(0.9, 0.2, r); // 1 center -> 0 edges\n        float vigAmp = 0.06 * I;\n        col *= mix(1.0 - vigAmp, 1.0, vig);\n\n        // Refresh flicker (tiny amplitude)\n        float flick = 1.0 + (0.02 * I) * (u_motion * (sin(u_time*8.0) * 0.5));\n        col *= flick;\n\n        // Mild unsharp mask to restore crisp glyph edges\n        vec2 texel = 1.0 / u_res;\n        vec3 c0 = texture2D(u_tex, uvG).rgb;\n        vec3 c1 = texture2D(u_tex, clamp(uvG + vec2(texel.x, 0.0), vec2(0.0), vec2(1.0))).rgb;\n        vec3 c2 = texture2D(u_tex, clamp(uvG + vec2(-texel.x, 0.0), vec2(0.0), vec2(1.0))).rgb;\n        vec3 c3 = texture2D(u_tex, clamp(uvG + vec2(0.0, texel.y), vec2(0.0), vec2(1.0))).rgb;\n        vec3 c4 = texture2D(u_tex, clamp(uvG + vec2(0.0, -texel.y), vec2(0.0), vec2(1.0))).rgb;\n        vec3 blur = (c0 + c1 + c2 + c3 + c4) * 0.2;\n        float sharpen = 0.10; // keep subtle to avoid halos\n        col = clamp(col * (1.0 + sharpen) - blur * sharpen, 0.0, 1.0);\n\n        gl_FragColor = vec4(col, 1.0);\n      }\n    "),B=N.createProgram();if(N.attachShader(B,O),N.attachShader(B,F),N.linkProgram(B),!N.getProgramParameter(B,N.LINK_STATUS))return void console.error("Lens program link error:",N.getProgramInfoLog(B));u.current=B,N.useProgram(B);let k=N.getAttribLocation(B,"position"),G=N.createBuffer();N.bindBuffer(N.ARRAY_BUFFER,G),N.bufferData(N.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),N.STATIC_DRAW),N.enableVertexAttribArray(k),N.vertexAttribPointer(k,2,N.FLOAT,!1,0,0);let H=N.getUniformLocation(B,"u_res"),z=N.getUniformLocation(B,"u_tex"),W=N.getUniformLocation(B,"u_k1"),V=N.getUniformLocation(B,"u_k2"),j=N.getUniformLocation(B,"u_center"),K=N.getUniformLocation(B,"u_time"),Y=N.getUniformLocation(B,"u_alive"),q=N.getUniformLocation(B,"u_mainsHz"),Q=N.getUniformLocation(B,"u_motion"),Z=N.getUniformLocation(B,"u_intensity");z&&N.uniform1i(z,0),W&&N.uniform1f(W,a),V&&N.uniform1f(V,i),j&&N.uniform2f(j,o.x,o.y),Q&&N.uniform1f(Q,+!f.current);let J=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--crt-intensity"))||.1;Z&&N.uniform1f(Z,J),Y&&N.uniform1f(Y,0),q&&N.uniform1f(q,_.current||60);let ee=N.createTexture();c.current=ee,N.activeTexture(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,ee),N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,1),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE);let et=N.getExtension("EXT_texture_filter_anisotropic")||N.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||N.getExtension("MOZ_EXT_texture_filter_anisotropic");if(et){let e=N.getParameter(et.MAX_TEXTURE_MAX_ANISOTROPY_EXT)||4;N.texParameterf(N.TEXTURE_2D,et.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(4,e))}let er=()=>{if(!B||!N)return;let e=performance.now();K&&N.uniform1f(K,.001*e);let t=Math.max(1e-4,(e-R.current)*.001);R.current=e,g.current=.9*g.current+1/t*.1,g.current<30?(null==x.current&&(x.current=e),!T.current&&x.current&&e-x.current>3e3&&(T.current=!0)):(x.current=null,T.current?(null==w.current&&(w.current=e),e-w.current>1500&&(T.current=!1)):w.current=null);let r=Math.min(f.current?0:E.current,T.current?.3:1);if(Y&&N.uniform1f(Y,r),q&&N.uniform1f(q,_.current||60),e-b.current>500){b.current=e;try{window.dispatchEvent(new CustomEvent("crt-state",{detail:{alive:E.current,effectiveAlive:r,mainsHz:_.current,fps:g.current,gated:T.current,reduced:f.current,mode:"LQ",buffers:"none",decayMs:{...y.current},halo:L.current,beam:{on:A.current,beamPx:U.current,modDepth:P.current,interlace:S.current}}}))}catch(e){}}N.clearColor(0,0,0,0),N.clear(N.COLOR_BUFFER_BIT),N.drawArrays(N.TRIANGLES,0,6),f.current||(d.current=requestAnimationFrame(er))},en=!1,ea=async()=>{if(!en){en=!0;try{let e=await $(I,{pixelRatio:m.current,cacheBust:!0,filter:e=>!(e instanceof Element)||e!==M&&!e.classList.contains("lens-warp")}),t=new Image;t.onload=()=>{N.bindTexture(N.TEXTURE_2D,ee),N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,t),er(),p.current||(p.current=!0,requestAnimationFrame(()=>{window.dispatchEvent(new Event("webgl-ready"))}))},t.src=e}catch(e){console.warn("Lens capture failed",e)}finally{v.current=performance.now(),en=!1}}},ei=()=>{if(h.current)return;let e=Math.max(200,200-(performance.now()-v.current));h.current=window.setTimeout(()=>{h.current=null,ea()},e)},eo=()=>{let e=I.getBoundingClientRect(),t=Math.min(Math.max(window.devicePixelRatio||1,2),2.5);m.current=t;let r=Math.max(1,Math.floor(e.width)),n=Math.max(1,Math.floor(e.height));M.width=Math.floor(r*t),M.height=Math.floor(n*t),M.style.width="".concat(r,"px"),M.style.height="".concat(n,"px"),N.viewport(0,0,M.width,M.height),H&&N.uniform2f(H,M.width,M.height),ei()},el=new ResizeObserver(eo);el.observe(I),eo();let ec=new MutationObserver(e=>{for(let t of e){let e=t.target;if(!(e&&e instanceof Element&&e.classList.contains("lens-warp"))){ei();break}}});return ec.observe(I,{subtree:!0,childList:!0,characterData:!0,attributes:!1}),window.addEventListener("resize",ei),window.addEventListener("ascii-ready",ea),()=>{window.removeEventListener("crt-alive",D),el.disconnect(),ec.disconnect(),window.removeEventListener("resize",ei),window.removeEventListener("ascii-ready",ea),d.current&&cancelAnimationFrame(d.current),N&&c.current&&N.deleteTexture(c.current),N&&u.current&&N.deleteProgram(u.current)}},[a,i,o.x,o.y]),(0,t.jsx)("canvas",{ref:l,className:"lens-warp","aria-hidden":!0,"data-ignore-snapshot":!0,"data-section":n.Sections.LENS_WARP_CANVAS})}},72679,e=>{"use strict";e.s(["default",()=>a]);var t=e.i(43476),r=e.i(71645),n=e.i(84516);function a(){let[e,a]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let t=()=>a(!0);window.addEventListener("webgl-ready",t);let r=window.setTimeout(()=>{e||a(!0)},3500);return()=>{window.removeEventListener("webgl-ready",t),window.clearTimeout(r)}},[e]),(0,t.jsx)("div",{id:"boot-overlay","data-section":n.Sections.BOOT_OVERLAY,"aria-hidden":"true",style:{position:"fixed",inset:0,background:"#000",zIndex:9999,opacity:+!e,pointerEvents:e?"none":"auto",transition:"opacity 300ms ease"}})}},19510,e=>{"use strict";e.s(["default",()=>a]);var t=e.i(71645),r=e.i(21240);let n={alive:0,effectiveAlive:0,mainsHz:60,fps:60,gated:!1,reduced:!1};function a(){return(0,t.useEffect)(()=>{let e={...n},t=t=>{t.detail&&(e={...e,...t.detail})};window.addEventListener("crt-state",t);let a={help(){console.log("CRT console API\n\nwindow.CRT.get()                       -> current state\nwindow.CRT.set(alive[, mainsHz])       -> set alive [0..1] and optional mains\nwindow.CRT.set({ alive, mainsHz })     -> same via object\nwindow.CRT.enable() / window.CRT.disable()\nwindow.CRT.hz(50|60)                   -> set mains Hz\nwindow.CRT.phosphor({ rMs,gMs,bMs,halo }) -> set decay (s) and halo gain\nwindow.CRT.mode('HQ'|'LQ')           -> force mode and reload\nwindow.CRT.beam({ on, beamPx, modDepth, interlace }) -> beam controls (HQ only)\n")},get:()=>({...e}),set(t,n){if("number"==typeof t)(0,r.setCRTAlive)(t,n);else{let a="number"==typeof t.alive?t.alive:e.alive,i="number"==typeof t.mainsHz?t.mainsHz:"number"==typeof n?n:e.mainsHz;(0,r.setCRTAlive)(a,i)}return a.get()},enable:()=>a.set(1),disable:()=>a.set(0),hz:t=>a.set(e.alive,t),phosphor:e=>((0,r.setPhosphor)(e),a.get()),mode(e){try{localStorage.setItem("crt-mode",e)}catch(e){}location.reload()},beam:e=>(window.dispatchEvent(new CustomEvent("crt-beam",{detail:e})),a.get())};try{Object.defineProperty(window,"CRT",{value:a,writable:!1}),console.log("CRT dev console ready: window.CRT.help()")}catch(e){console.warn("Unable to attach window.CRT")}return()=>{window.removeEventListener("crt-state",t),window.CRT=void 0}},[]),null}}]);